# MockServer v0.7.0 API æ›´æ–°è¯´æ˜

## ğŸ“‹ API å˜æ›´æ¦‚è§ˆ

MockServer v0.7.0 å¼•å…¥äº†é‡è¦çš„ç¼“å­˜ç³»ç»ŸAPIï¼Œå¹¶å¯¹ç°æœ‰APIè¿›è¡Œäº†ä¼˜åŒ–ã€‚

## ğŸ†• æ–°å¢API

### ç¼“å­˜ç®¡ç†API

#### è·å–ç¼“å­˜ç»Ÿè®¡
```http
GET /api/v1/cache/stats
```

**å“åº”ç¤ºä¾‹:**
```json
{
  "l1_cache": {
    "hit_rate": 0.95,
    "miss_rate": 0.05,
    "eviction_count": 12,
    "current_size": 850
  },
  "l2_cache": {
    "hit_rate": 0.87,
    "miss_rate": 0.13,
    "connection_pool": {
      "active": 15,
      "idle": 85,
      "total": 100
    }
  },
  "overall": {
    "total_hit_rate": 0.92,
    "total_requests": 10000,
    "cache_size": 1850
  }
}
```

#### æ¸…é™¤ç¼“å­˜
```http
DELETE /api/v1/cache/clear
```

**å“åº”ç¤ºä¾‹:**
```json
{
  "success": true,
  "message": "Cache cleared successfully",
  "cleared_items": 1850
}
```

#### é¢„çƒ­ç¼“å­˜
```http
POST /api/v1/cache/warmup
Content-Type: application/json

{
  "keys": ["user:123", "config:app", "stats:daily"],
  "ttl": "1h"
}
```

#### ç¼“å­˜é…ç½®ç®¡ç†
```http
GET /api/v1/cache/config
```

```http
PUT /api/v1/cache/config
Content-Type: application/json

{
  "l1_memory": {
    "max_size": 2000,
    "ttl": "2h"
  },
  "l2_redis": {
    "address": "redis://localhost:6379",
    "pool_size": 200,
    "max_retries": 3
  }
}
```

### WebSocketå¢å¼ºAPI

#### WebSocketç»Ÿè®¡
```http
GET /api/v1/websocket/stats
```

**å“åº”ç¤ºä¾‹:**
```json
{
  "active_connections": 45,
  "total_connections": 1250,
  "messages_sent": 8900,
  "messages_received": 7600,
  "average_session_duration": "5m30s",
  "peak_concurrent_connections": 125
}
```

#### å¹¿æ’­æ¶ˆæ¯
```http
POST /api/v1/websocket/broadcast
Content-Type: application/json

{
  "message": "System maintenance in 5 minutes",
  "target": "all", // "all", "room:room1", "user:user123"
  "type": "notification"
}
```

## ğŸ”§ ä¼˜åŒ–API

### é¡¹ç›®ç®¡ç†APIå¢å¼º

#### é¡¹ç›®ç¼“å­˜ç»Ÿè®¡
```http
GET /api/v1/projects/{id}/cache-stats
```

**å“åº”ç¤ºä¾‹:**
```json
{
  "project_id": "proj_123",
  "cache_enabled": true,
  "cache_hit_rate": 0.89,
  "cached_rules": 25,
  "cache_size": "2.5MB",
  "last_cache_update": "2025-11-19T10:30:00Z"
}
```

### è§„åˆ™ç®¡ç†APIå¢å¼º

#### è§„åˆ™æ€§èƒ½åˆ†æ
```http
GET /api/v1/rules/performance
```

**å“åº”ç¤ºä¾‹:**
```json
{
  "average_response_time": "15ms",
  "p95_response_time": "45ms",
  "p99_response_time": "120ms",
  "rules_executed_per_minute": 850,
  "cache_hit_rate_for_rules": 0.76,
  "top_slow_rules": [
    {
      "rule_id": "rule_456",
      "average_time": "120ms",
      "execution_count": 150
    }
  ]
}
```

### ç³»ç»Ÿç›‘æ§APIå¢å¼º

#### ç³»ç»Ÿå¥åº·æ£€æŸ¥ v2
```http
GET /api/v2/system/health
```

**å“åº”ç¤ºä¾‹:**
```json
{
  "status": "healthy",
  "version": "v0.7.0",
  "uptime": "72h30m15s",
  "components": {
    "database": {
      "status": "healthy",
      "response_time": "5ms",
      "connection_pool": {
        "active": 5,
        "idle": 15,
        "total": 20
      }
    },
    "cache": {
      "status": "healthy",
      "l1_cache": "operational",
      "l2_cache": "connected",
      "overall_hit_rate": 0.92
    },
    "websocket": {
      "status": "operational",
      "active_connections": 45,
      "max_connections": 1000
    }
  },
  "performance": {
    "cpu_usage": "25%",
    "memory_usage": "512MB",
    "disk_usage": "2.1GB",
    "network_io": {
      "bytes_in": "1.2GB",
      "bytes_out": "800MB"
    }
  },
  "timestamp": "2025-11-19T10:30:00Z"
}
```

## ğŸ“Š æ–°å¢å“åº”å¤´

### ç¼“å­˜ç›¸å…³å¤´éƒ¨
```http
X-Cache-Status: HIT | MISS | BYPASS
X-Cache-TTL: 3600
X-Cache-Key: user:123
X-Cache-Layer: L1 | L2
```

### æ€§èƒ½ç›‘æ§å¤´éƒ¨
```http
X-Response-Time: 25ms
X-Cache-Response-Time: 2ms
X-Processing-Time: 23ms
```

## ğŸ”„ åºŸå¼ƒAPI

### v0.6.x APIå˜æ›´
ä»¥ä¸‹APIåœ¨v0.7.0ä¸­å·²åºŸå¼ƒï¼Œå°†åœ¨v0.8.0ä¸­ç§»é™¤ï¼š

#### åºŸå¼ƒçš„å¥åº·æ£€æŸ¥API
```http
# å·²åºŸå¼ƒ
GET /api/v1/system/health

# æ¨èä½¿ç”¨
GET /api/v2/system/health
```

#### åºŸå¼ƒçš„ç»Ÿè®¡API
```http
# å·²åºŸå¼ƒ
GET /api/v1/stats

# æ¨èä½¿ç”¨
GET /api/v1/system/metrics
```

## ğŸ›¡ï¸ å®‰å…¨æ€§å¢å¼º

### APIè®¤è¯å¢å¼º
- **ç¼“å­˜æƒé™æ§åˆ¶**: ç¼“å­˜æ“ä½œéœ€è¦ç›¸åº”æƒé™
- **WebSocketè®¤è¯**: WebSocketè¿æ¥æ”¯æŒJWTè®¤è¯
- **APIé™æµ**: ç¼“å­˜APIæœ‰ç‹¬ç«‹çš„é™æµç­–ç•¥

### è¯·æ±‚éªŒè¯
- **ç¼“å­˜é”®éªŒè¯**: é˜²æ­¢ç¼“å­˜é”®å†²çªå’Œæ±¡æŸ“
- **å¤§å°é™åˆ¶**: ç¼“å­˜æ“ä½œæœ‰å¤§å°é™åˆ¶ä¿æŠ¤
- **é¢‘ç‡é™åˆ¶**: é˜²æ­¢ç¼“å­˜æ»¥ç”¨

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

### å“åº”æ—¶é—´æ”¹è¿›
- **ç¼“å­˜å‘½ä¸­**: å¹³å‡å“åº”æ—¶é—´å‡å°‘80%
- **æ•°æ®åº“æŸ¥è¯¢**: ç¼“å­˜å‘½ä¸­æ—¶å‡å°‘95%
- **è§„åˆ™åŒ¹é…**: ç¼“å­˜è§„åˆ™åŒ¹é…å‡å°‘70%

### ååé‡æå‡
- **å¹¶å‘å¤„ç†**: æå‡40%
- **è¯·æ±‚å¤„ç†**: æå‡60%
- **å†…å­˜ä½¿ç”¨**: ä¼˜åŒ–å‡å°‘30%

## ğŸ”— APIæ–‡æ¡£æ›´æ–°

### å®Œæ•´APIæ–‡æ¡£
- **Swagger UI**: `http://localhost:8080/swagger/index.html`
- **OpenAPIè§„èŒƒ**: `http://localhost:8080/api/docs/openapi.json`

### ç¤ºä¾‹ä»£ç 
```javascript
// JavaScript/TypeScript ç¤ºä¾‹
const MockServerAPI = {
  // ç¼“å­˜ç»Ÿè®¡
  async getCacheStats() {
    const response = await fetch('/api/v1/cache/stats');
    return response.json();
  },

  // WebSocketå¹¿æ’­
  async broadcast(message, target = 'all') {
    const response = await fetch('/api/v1/websocket/broadcast', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ message, target, type: 'notification' })
    });
    return response.json();
  },

  // ç³»ç»Ÿå¥åº·æ£€æŸ¥ v2
  async getHealthStatus() {
    const response = await fetch('/api/v2/system/health');
    return response.json();
  }
};

// ä½¿ç”¨ç¤ºä¾‹
const stats = await MockServerAPI.getCacheStats();
console.log(`ç¼“å­˜å‘½ä¸­ç‡: ${stats.overall.total_hit_rate}`);
```

```python
# Python ç¤ºä¾‹
import requests

class MockServerAPI:
    def __init__(self, base_url="http://localhost:8080/api/v1"):
        self.base_url = base_url

    def get_cache_stats(self):
        """è·å–ç¼“å­˜ç»Ÿè®¡ä¿¡æ¯"""
        response = requests.get(f"{self.base_url}/cache/stats")
        return response.json()

    def clear_cache(self):
        """æ¸…é™¤æ‰€æœ‰ç¼“å­˜"""
        response = requests.delete(f"{self.base_url}/cache/clear")
        return response.json()

    def warmup_cache(self, keys, ttl="1h"):
        """é¢„çƒ­ç¼“å­˜"""
        response = requests.post(f"{self.base_url}/cache/warmup",
                                   json={"keys": keys, "ttl": ttl})
        return response.json()

# ä½¿ç”¨ç¤ºä¾‹
api = MockServerAPI()
stats = api.get_cache_stats()
print(f"æ•´ä½“ç¼“å­˜å‘½ä¸­ç‡: {stats['overall']['total_hit_rate']:.2%}")
```

## ğŸš€ è¿ç§»æŒ‡å—

### ä»v0.6.xè¿ç§»
1. **æ›´æ–°åŸºç¡€URL**: ä½¿ç”¨ `/api/v1` å‰ç¼€
2. **å¤„ç†åºŸå¼ƒAPI**: æ›¿æ¢ä¸ºæ–°çš„ç­‰æ•ˆAPI
3. **æ·»åŠ ç¼“å­˜é€»è¾‘**: åˆ©ç”¨æ–°çš„ç¼“å­˜APIæå‡æ€§èƒ½
4. **æ›´æ–°é”™è¯¯å¤„ç†**: å¤„ç†æ–°çš„ç¼“å­˜ç›¸å…³é”™è¯¯ä»£ç 

### ç¤ºä¾‹è¿ç§»ä»£ç 
```javascript
// v0.6.x æ–¹å¼
const health = await fetch('/api/v1/system/health');

// v0.7.0 æ–¹å¼
const health = await fetch('/api/v2/system/health');
const data = await health.json();

// åˆ©ç”¨ç¼“å­˜
if (data.components.cache.status === 'healthy') {
    const cacheStats = await fetch('/api/v1/cache/stats');
    // ä½¿ç”¨ç¼“å­˜ç»Ÿè®¡ä¿¡æ¯
}
```

## ğŸ“ ç‰ˆæœ¬å…¼å®¹æ€§

- **å‘åå…¼å®¹**: v0.7.0ä¿æŒä¸v0.6.x APIçš„å…¼å®¹æ€§
- **å¼ƒç”¨è­¦å‘Š**: ä½¿ç”¨åºŸå¼ƒAPIæ—¶ä¼šæ”¶åˆ°è­¦å‘Šä¿¡æ¯
- **ç§»é™¤è®¡åˆ’**: v0.8.0å°†å®Œå…¨ç§»é™¤åºŸå¼ƒAPI

## ğŸ” è°ƒè¯•å·¥å…·

### APIæµ‹è¯•å·¥å…·
```bash
# æµ‹è¯•ç¼“å­˜API
curl -X GET http://localhost:8080/api/v1/cache/stats

# æµ‹è¯•WebSocketç»Ÿè®¡
curl -X GET http://localhost:8080/api/v1/websocket/stats

# æµ‹è¯•ç³»ç»Ÿå¥åº·v2
curl -X GET http://localhost:8080/api/v2/system/health
```

### ç›‘æ§é¢æ¿
- **ç¼“å­˜æŒ‡æ ‡**: å®æ—¶ç›‘æ§ç¼“å­˜æ€§èƒ½
- **APIæ€§èƒ½**: ç›‘æ§APIå“åº”æ—¶é—´å’Œé”™è¯¯ç‡
- **ç³»ç»Ÿèµ„æº**: ç›‘æ§CPUã€å†…å­˜ã€ç½‘ç»œä½¿ç”¨æƒ…å†µ

---

**ğŸ“š å®Œæ•´APIæ–‡æ¡£**: [APIæ–‡æ¡£é¦–é¡µ](../api/README.md)
**ğŸ”§ å¼€å‘æŒ‡å—**: [å¼€å‘æ–‡æ¡£](../development/README.md)
**ğŸš€ å¿«é€Ÿå¼€å§‹**: [å¿«é€Ÿå¼€å§‹æŒ‡å—](../../README.md#quick-start)