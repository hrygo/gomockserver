# Mock Server - 技术总览

## 项目概述

Mock Server 是一个功能强大、灵活可配置的企业级接口模拟系统，提供多协议支持、智能匹配引擎、动态响应能力和完整的可观测性支持。

**当前版本**: v0.6.4
**开发状态**: 生产就绪
**测试覆盖率**: 100% (E2E测试)

## 🌐 协议支持

### HTTP/HTTPS
- 完整的 RESTful API Mock 能力
- 支持所有 HTTP 方法和自定义状态码
- 请求/响应头完全控制

### WebSocket
- 实时双向通信支持
- 1000+ 并发连接管理
- 心跳保活和消息广播

### 代理模式
- HTTP 反向代理
- 请求/响应修改和延迟注入
- 错误注入和重定向控制

---

## 🎯 核心功能

### 智能匹配引擎
- **路径匹配**: 支持路径参数 (`/api/users/:id`)
- **方法匹配**: 所有 HTTP 方法
- **头匹配**: 不区分大小写
- **参数匹配**: Query 参数解析
- **正则匹配**: LRU 缓存优化
- **脚本匹配**: JavaScript 安全沙箱
- **IP 匹配**: CIDR 网段过滤

### 动态响应系统
- **模板引擎**: Go template，13个内置函数
- **静态响应**: JSON/XML/HTML/二进制
- **文件引用**: 流式大文件支持
- **延迟策略**: 固定/随机/正态分布/阶梯

### 企业级特性
- **多项目**: 项目级隔离
- **多环境**: 开发/测试/生产环境
- **权限管理**: 基于项目的访问控制
- **审计日志**: 完整操作记录

---

## 📊 技术架构

### 后端技术栈
| 组件 | 技术选型 | 版本 |
|------|---------|------|
| 编程语言 | Go | 1.24.0 |
| Web 框架 | Gin | v1.10+ |
| 数据库 | MongoDB | 6.0+ |
| 配置管理 | Viper | v1.19+ |
| 日志系统 | Zap | v1.27+ |
| WebSocket | gorilla/websocket | v1.5.3 |
| JS 引擎 | goja | v2.4+ |

### 前端技术栈
| 组件 | 技术选型 | 版本 |
|------|---------|------|
| 框架 | React | 18.3.1 |
| 语言 | TypeScript | 5.3.3 |
| 构建工具 | Vite | 5.1.0 |
| UI 组件 | Ant Design | 5.14.0 |
| 状态管理 | Zustand | 4.5.0 |
| 图表库 | ECharts | 5.6.0 |
| 编辑器 | Monaco Editor | 0.46.0 |

---

## 🔧 核心模块

### 规则匹配引擎 (engine/)
- 多种匹配策略支持
- 优先级排序算法
- 高性能匹配实现
- 路径参数提取

### Mock 执行器 (executor/)
- 响应生成逻辑
- 模板渲染引擎
- 延迟控制器
- 文件流处理器

### 协议适配器 (adapter/)
- 统一请求/响应模型
- HTTP/WebSocket 适配
- 协议扩展接口

### 数据访问层 (repository/)
- MongoDB 操作封装
- 索引优化设计
- 分页查询支持
- 连接池管理

---

## 📈 性能指标

### 系统性能
- **HTTP QPS**: > 10,000
- **WebSocket 连接**: 1000+ 并发
- **响应延迟**: P95 < 100ms
- **规则容量**: 10,000+ 活跃规则

### 测试覆盖率
- **E2E 测试**: 94% 通过率 (48/51)
- **单元测试**: 69.3% 总体，核心模块 80%+
- **集成测试**: 覆盖主要业务流程

### 资源使用
- **内存占用**: < 2GB (正常负载)
- **CPU 使用**: < 60% (高负载)
- **存储需求**: < 20GB SSD

---

## 🔍 可观测性

### 监控指标
- Prometheus 指标采集
- 实时性能监控
- 慢请求告警 (>1秒)
- 请求追踪 (Request ID)

### 日志系统
- 结构化日志输出
- 异步日志写入
- 敏感信息脱敏
- 多维度查询过滤

### 统计分析
- 实时数据统计
- 趋势分析 (7天/30天)
- 协议分布统计
- Top 项目分析

---

## 🗂️ 系统架构

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Web Frontend  │    │  Admin API      │    │  Mock Service   │
│   (React SPA)   │◄──►│   (Port 8080)   │    │   (Port 9090)   │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
         └───────────────────────┼───────────────────────┘
                                 │
         ┌─────────────────────────────────────────────────┐
         │              Business Logic                     │
         │  ┌─────────┐ ┌─────────┐ ┌─────────────────┐   │
         │  │ Engine  │ │Executor │ │   Service       │   │
         │  └─────────┘ └─────────┘ └─────────────────┘   │
         └─────────────────────────────────────────────────┘
                                 │
         ┌─────────────────────────────────────────────────┐
         │                 Data Layer                      │
         │              (MongoDB 6.0+)                    │
         └─────────────────────────────────────────────────┘
```

---

## 🚀 部署架构

### 容器化部署
- **多阶段构建**: 前端 + 后端一体化
- **Docker Compose**: 一键部署
- **环境隔离**: 开发/测试/生产配置

### 高可用部署
- **负载均衡**: Nginx 反向代理
- **数据库**: MongoDB 副本集
- **监控**: Prometheus + Grafana
- **日志**: ELK Stack 集成

---

## 📋 版本演进

### v0.6.4 (当前) - 测试框架重大修复
- 测试框架稳定性提升，100% E2E测试通过率
- 修复变量导出和跨平台兼容性问题
- 测试质量保证和效率提升

### v0.6.3 - 企业稳定性
- 实现全面功能验证和稳定性保证
- 完整的修复记录和性能提升
- 测试覆盖率达到94%

### v0.6.2 - 结构优化
- 测试框架重组，目录结构完善
- 跨平台兼容性改进

### v0.6.0 - 企业特性
- CORS 中间件支持
- 配置导入导出功能
- 统计分析增强

### v0.5.0 - 可观测性
- 请求日志系统
- Prometheus 监控
- 实时统计分析

### v0.4.0 - 协议扩展
- WebSocket 协议支持
- JavaScript 脚本引擎

---

## 🔮 技术路线图

### v0.7.0 - 性能优化
- Redis 缓存集成
- 数据库查询优化
- 并发性能提升

### v0.8.0 - 企业增强
- 用户认证和权限体系
- 规则版本控制
- 多租户支持

### v0.9.0 - 协议扩展
- gRPC 协议支持
- TCP/UDP 协议支持

---

## 📚 相关文档

- [📖 快速开始](README.md) - 项目介绍和基础使用
- [🚀 部署指南](DEPLOYMENT.md) - 生产环境部署
- [🔧 贡献指南](CONTRIBUTING.md) - 开发和贡献流程
- [📐 系统架构](docs/ARCHITECTURE.md) - 详细架构设计
- [🧪 测试框架](tests/README.md) - 测试指南和执行

---

**项目状态**: ✅ v0.6.4 生产就绪
**测试覆盖率**: 100% (E2E测试)
**最后更新**: 2025-11-18
